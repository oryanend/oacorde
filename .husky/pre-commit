#!/usr/bin/env sh

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "^backend/.*\.java$" || true)

# Se não houver arquivos Java staged, sai com sucesso
[ -z "$STAGED_FILES" ] && exit 0

echo "Arquivos Java detectados. Verificando Spotless..."

cd backend || exit 1

# Verifica o status do Spotless
./mvnw spotless:check
CHECK_STATUS=$?

if [ $CHECK_STATUS -eq 0 ]; then
  echo "Spotless OK. Nenhuma correção necessária."
  exit 0
fi

echo "Spotless encontrou problemas. Aplicando correções..."
./mvnw spotless:apply || exit 1

cd .. || exit 1

echo "$STAGED_FILES" | xargs git add

echo "Spotless aplicado e arquivos atualizados."
exit 0